# 学习笔记

## 我们在数据库操作的时候，比如 dao 层中当遇到一个 sql.ErrNoRows 的时候，是否应该 Wrap 这个 error，抛给上层。为什么，应该怎么做请写出代码？

```
结论：不一定Wrap这个error。

具体分为两种情况：

    一、不需要Wrap的情况

    1. 如果dao层的代码文件是通过template文件生成出来的，并且template文件也不会轻易被修改，那么这样的文件是不允许被修改的，
    那么可以将这样的dao层文件看作类似内部基础库的代码文件，所以就没有必要Wrap这一层的error，直接抛给上层就可以了。

    二、需要Wrap的情况

    1. 手动编写的dao层代码，但凡能是手动编写肯定是不算很稳定的，不能保证自己或者同事做相关修改的时候不出错。
    所以是有必要通过Wrap函数保存dao层的堆栈信息，不然问题是很难去track的。

    2. 即便是通过template文件来生成dao层文件，在一些要求很高的业务场景下，如果存在做一次查询，查询从库没有找到数据(正常应该是有数据的)，
    在主从延迟或者其他问题出现的同时，必须要再进一步查询一下主库，这个时候就需要Wrap这个error，并且说明实际是在哪一步出现了ErrNoRows，
    以此来保证数据即便在出现部分问题的时候也能handle住。




```


## 课堂问答笔记

```

wrap操作不是一定要在dao层发生，理论上是在第一次发生错误的地方wrap错误

关于重试这块的逻辑，建议每一次重试都打出error的log，即便可能打印的重复log会很多

pkg/errors 使用其中的Wrap； 然后使用标准库中 Is()/ As() / UnWrap() 作为pkg/errors库兼容的解决方案

考虑内部底层库调用第三方库的时候，第三方库A的接口返回error之后，是否考虑在内部底层库包装A库的error，还是向上抛出自定义的error，还是直接返回A库的error？
分情况吧

error的wrap影响性能应该是可控的


withMessage 就是只携带一部分额外添加的信息

记录异常日志，一般是在middleware层处理

verbose

```

